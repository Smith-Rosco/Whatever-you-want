<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>äº¤äº’å¼æ‚¬æµ®é¢æ¿ v2.0 (ç´«è‰²ä¸»é¢˜ - æ–°æŒ‰é’® - çŠ¶æ€æ˜¾ç¤º)</title>
  <style>
    /* --- Base Styles --- */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      /* Updated background gradient */
      background: linear-gradient(135deg, #f3e8ff, #e9d5ff); /* Lighter purple gradient */
      font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif; /* Slightly modern font */
    }

    /* --- Panel Container --- */
    .interactive-panel {
      position: fixed;
      top: 60px;
      left: 60px;
      width: 420px; /* Initial width */
      max-height: 650px; /* Max height */
      /* New background/blur */
      background: rgba(250, 245, 255, 0.65); /* Very light purple semi-transparent */
      backdrop-filter: blur(14px);
      border-radius: 18px; /* Slightly adjusted radius */
      /* Updated shadow with purple tint */
      box-shadow: 0 8px 25px rgba(109, 40, 217, 0.1); /* Subtle purple shadow */
      display: flex;
      flex-direction: column;
      overflow: hidden;
      resize: both;
      transition: box-shadow 0.3s ease;
      z-index: 9999;
      min-width: 250px; /* Adjusted min-width to accommodate controls */
      min-height: 50px; /* Min height for header */
      border: 1px solid rgba(167, 139, 250, 0.3); /* Subtle border */
    }
    .interactive-panel:hover {
      box-shadow: 0 12px 30px rgba(109, 40, 217, 0.18); /* Enhanced purple shadow on hover */
    }

    /* --- Collapsed State --- */
    .panel-collapsed {
      overflow: hidden !important;
      resize: none !important;
      /* height is set by JS */
    }
    .panel-collapsed .tab-navigation,
    .panel-collapsed .tab-content {
      display: none;
    }

    /* --- Panel Header --- */
    .panel-header {
      /* New header background */
      background: linear-gradient(to right, #6d28d9, #8b5cf6); /* Vibrant purple gradient */
      color: #fff;
      padding: 10px 15px; /* Adjusted padding */
      cursor: move;
      display: flex;
      align-items: center;
      justify-content: space-between;
      user-select: none;
      font-size: 1rem; /* 16px */
      font-weight: 600; /* Slightly bolder */
      box-sizing: border-box;
      min-height: 48px; /* Ensure min height */
      flex-shrink: 0; /* Prevent header from shrinking */
    }
    .panel-title-area {
        display: flex;
        align-items: center;
        gap: 10px; /* Space between title and status */
        /* Allow title area to shrink if needed, but give it priority */
        flex-grow: 1;
        flex-shrink: 1;
        min-width: 50px; /* Prevent extreme collapse */
        overflow: hidden; /* Hide overflow if title+status is too long */
    }
    .panel-title {
        white-space: nowrap; /* Prevent title wrap */
        overflow: hidden;
        text-overflow: ellipsis; /* Add ellipsis if title is too long */
    }
    /* NEW: Status Display */
    .panel-status-display {
      font-size: 0.8rem; /* Smaller font size */
      font-weight: 400;
      padding: 2px 6px;
      background: rgba(255, 255, 255, 0.2); /* Subtle background */
      border-radius: 4px;
      white-space: nowrap; /* Prevent status text wrap */
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100px; /* Limit status width */
    }
    /* Container for control buttons */
    .panel-controls {
        display: flex;
        align-items: center;
        gap: 5px; /* Space between buttons */
        flex-shrink: 0; /* Prevent controls from shrinking */
    }
    /* Shared button style for header controls */
    .panel-header-button {
      background: transparent;
      border: none;
      color: #ede9fe; /* Light violet text */
      font-size: 1.1rem; /* Slightly larger icons */
      cursor: pointer;
      transition: transform 0.2s ease, color 0.2s ease;
      padding: 0 5px;
      line-height: 1;
      border-radius: 4px; /* Subtle rounding */
    }
    .panel-header-button:hover {
      transform: scale(1.15);
      color: #ffffff; /* Brighter white on hover */
    }
    .panel-header-button:active {
        transform: scale(1.05); /* Click feedback */
    }
    /* Specific classes if needed, but shared style is likely fine */
    .panel-toggle {}
    .panel-refresh {}
    .panel-simplify {}

    /* --- Tab Navigation --- */
    .tab-navigation {
      display: flex;
      /* New tab nav background */
      background: rgba(237, 233, 254, 0.8); /* Lighter violet */
      border-bottom: 1px solid #c4b5fd; /* Violet border */
      flex-shrink: 0;
      padding: 3px 5px 0; /* Add padding for spacing and to lift buttons */
    }
    .tab-button {
      flex: 1;
      padding: 9px 5px; /* Adjusted padding */
      background: transparent;
      border: none;
      font-size: 0.875rem; /* 14px */
      cursor: pointer;
      transition: background 0.3s, color 0.3s, border-color 0.3s;
      color: #5b21b6; /* Darker violet text */
      white-space: nowrap;
      border-bottom: 3px solid transparent; /* Placeholder for active indicator */
      margin: 0 2px;
      border-radius: 6px 6px 0 0; /* Round top corners */
    }
    .tab-button:hover {
      background: rgba(196, 181, 253, 0.4); /* Lighter violet hover */
      color: #4c1d95; /* Darker violet on hover */
    }
    .tab-button.active {
      /* Active tab uses header gradient */
      background: linear-gradient(to right, #a78bfa, #c4b5fd); /* Lighter purple gradient */
      color: #3730a3; /* Dark indigo text for contrast */
      font-weight: 600;
      border-bottom: 3px solid #6d28d9; /* Strong purple indicator */
    }

    /* --- Tab Content --- */
    .tab-content {
      flex: 1;
      overflow-y: auto;
      padding: 15px 20px; /* Adjusted padding */
      background: transparent;
      transition: opacity 0.4s ease;
      min-height: 100px; /* Ensure minimum content height */
      color: #374151; /* Dark gray content text */
    }
    .tab-panel {
      display: none;
      animation: fadeIn 0.4s ease forwards;
    }
    .tab-panel.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* --- Content Specific Styles (Purple Theme) --- */
    .tab-panel h2 {
      color: #6d28d9; /* Main purple for headings */
      margin-top: 0;
      margin-bottom: 15px;
      border-bottom: 1px solid #ddd6fe; /* Light violet underline */
      padding-bottom: 5px;
    }
    .tab-panel strong {
      color: #7c3aed; /* Slightly lighter purple for strong tags */
    }

    .memory-area ol { position: relative; margin-left: 15px; padding-left: 25px; list-style: none; }
    .memory-area ol::before { content: ""; position: absolute; left: 8px; top: 5px; bottom: 5px; width: 2px; background: #a78bfa; border-radius: 1px; } /* Lighter purple line */
    .memory-area ol li { position: relative; padding: 10px 0; }
    .memory-area ol li::before { content: ""; position: absolute; left: -21px; top: 50%; transform: translateY(-50%); width: 10px; height: 10px; background: #8b5cf6; border-radius: 50%; border: 2px solid #f3e8ff; } /* Purple dot with light bg border */

    .status-bar ul { padding-left: 20px; margin: 10px 0; }
    .status-bar ul ul { padding-left: 20px; }
    .status-bar li { margin-bottom: 5px; }

    .options-area ol { list-style: none; padding: 0; margin: 0; }
    .options-area li {
      background: rgba(167, 139, 250, 0.15); /* Light violet background */
      margin-bottom: 10px;
      padding: 12px 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
      border-left: 4px solid #a78bfa; /* Accent border */
      color: #4c1d95; /* Darker violet text */
    }
    .options-area li:hover {
      background: rgba(167, 139, 250, 0.25);
      transform: translateY(-2px);
      box-shadow: 0 3px 8px rgba(109, 40, 217, 0.08);
      border-left-color: #8b5cf6; /* Darker accent on hover */
    }

    .thinking-area ul { list-style: disc inside; margin: 0; padding: 0 0 0 15px; color: #5b21b6; }
    .thinking-area li { margin-bottom: 8px; }

    .text-body p { margin: 10px 0; line-height: 1.6; }
    /* Updated special text colors */
    .speech { color: #7c3aed; font-weight: bold; }
    .mentality { color: #9333ea; font-style: italic; } /* More distinct purple */
    .closeup { color: #5b21b6; text-decoration: underline; text-decoration-color: #a78bfa; text-decoration-thickness: 1px; text-underline-offset: 2px; } /* Darker purple underline */

    /* Scrollbar styling (optional, for a more themed look) */
    .tab-content::-webkit-scrollbar {
        width: 8px;
    }
    .tab-content::-webkit-scrollbar-track {
        background: #f3e8ff; /* Lightest purple */
        border-radius: 4px;
    }
    .tab-content::-webkit-scrollbar-thumb {
        background-color: #c4b5fd; /* Medium purple */
        border-radius: 4px;
        border: 2px solid #f3e8ff; /* Creates padding around thumb */
    }
    .tab-content::-webkit-scrollbar-thumb:hover {
        background-color: #a78bfa; /* Darker purple on hover */
    }

  </style>
</head>
<body>

<div class="interactive-panel">
  <div class="panel-header">
    <!-- Title and Status Area -->
    <div class="panel-title-area">
        <div class="panel-title">äº¤äº’é¢æ¿</div>
        <span class="panel-status-display" id="panelStatus">å°±ç»ª</span> <!-- NEW -->
    </div>
    <!-- Control Buttons Area -->
    <div class="panel-controls"> <!-- NEW -->
        <button class="panel-header-button panel-refresh" title="åˆ·æ–°" aria-label="åˆ·æ–°">ğŸ”„</button> <!-- NEW -->
        <button class="panel-header-button panel-simplify" title="ç®€åŒ–å›å¤" aria-label="ç®€åŒ–å›å¤">âœ¨</button> <!-- NEW -->
        <button class="panel-header-button panel-toggle" title="æŠ˜å /å±•å¼€" aria-label="æŠ˜å /å±•å¼€">â€“</button>
    </div>
  </div>
  <div class="tab-navigation">
    <button class="tab-button active" data-tab-target="text">æ–‡æœ¬å†…å®¹</button>
    <button class="tab-button" data-tab-target="thinking">æ€è€ƒåŒº</button>
    <button class="tab-button" data-tab-target="status">çŠ¶æ€ä¿¡æ¯</button>
    <button class="tab-button" data-tab-target="memory">è®°å¿†</button>
    <button class="tab-button" data-tab-target="options">é€‰é¡¹</button>
  </div>
  <div class="tab-content">
     <div class="tab-panel active" data-tab-panel="text" role="tabpanel">
      <div class="text-body">
        <h2>æ–‡ç« æ ‡é¢˜ç¤ºä¾‹</h2>
        <p>è¿™æ˜¯ä¸€æ®µç¤ºä¾‹æ–‡æœ¬å†…å®¹ï¼Œå±•ç¤ºäº†åŸºç¡€çš„æ®µè½æ ·å¼ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦å¡«å……å®é™…å†…å®¹ã€‚</p>
        <p>è¿™æ˜¯ä¸€ä¸ªå¯¹è¯ï¼š<span class="speech">â€œä½ å¥½ï¼Œæ²ˆå°å§ã€‚è¿™å—ç‰ä½©ä¼¼ä¹å¯¹ä½ å¾ˆé‡è¦ï¼Ÿâ€</span></p>
        <p>è¿™æ˜¯ä¸€ä¸ªå¿ƒç†æ´»åŠ¨ï¼š<span class="mentality">ï¼ˆä»–æ€ä¹ˆä¼šçŸ¥é“è¿™ç‰ä½©... éš¾é“æ˜¯æ¯äº²é‚£è¾¹çš„äººï¼Ÿï¼‰</span></p>
        <p>è¿™æ˜¯ä¸€ä¸ªç‰¹å†™ï¼š<span class="closeup">ã€Œç‰ä½©åœ¨æœˆå…‰ä¸‹æ³›ç€æ¸©æ¶¦çš„å…‰æ³½ï¼Œå¥‡ç‰¹çš„çº¹æ ·è‹¥éšè‹¥ç°ã€‚ã€</span></p>
        <p>æ›´å¤šå†…å®¹å¯ä»¥æ·»åŠ åœ¨è¿™é‡Œï¼Œæ»šåŠ¨æ¡ä¼šåœ¨å†…å®¹è¶…å‡ºæ—¶å‡ºç°ã€‚</p>
      </div>
    </div>
    <div class="tab-panel" data-tab-panel="thinking" role="tabpanel">
       <div class="thinking-area">
           <h2>æ€è€ƒè¿‡ç¨‹</h2>
           <ul>
               <li>ç›®æ ‡ï¼šä¸æ²ˆçŸ¥å¾®äº¤äº’ï¼Œæ¢æŸ¥ç‰ä½©ä¿¡æ¯ã€‚</li>
               <li>åˆæ­¥è§‚å¯Ÿï¼šå¥¹å¯¹ç‰ä½©ååº”å¼ºçƒˆï¼Œå¯èƒ½è®¤è¯†ã€‚</li>
               <li>é£é™©è¯„ä¼°ï¼šç›´æ¥è¯¢é—®å¯èƒ½å¼•èµ·è­¦æƒ•ï¼Œç”šè‡³å†²çªã€‚</li>
               <li>ç­–ç•¥1ï¼šè¯•æ¢æ€§è¯¢é—®ï¼Œè§‚å¯Ÿååº”ã€‚</li>
               <li>ç­–ç•¥2ï¼šè‹¥é‡å±é™©ï¼Œåˆ©ç”¨ç¯å¢ƒè„±èº«ï¼ˆå‡å±±ã€æ°´åŸŸï¼‰ã€‚</li>
               <li>å½“å‰å†³å®šï¼šé‡‡ç”¨ç­–ç•¥1ï¼Œè¨€è¯­æ¸©å’Œï¼Œä¿æŒè·ç¦»ã€‚</li>
           </ul>
       </div>
    </div>
    <div class="tab-panel" data-tab-panel="status" role="tabpanel">
       <div class="status-bar">
           <h2>åœºæ™¯ä¿¡æ¯</h2>
           <ul>
               <li><strong>æ—¶é—´ï¼š</strong> æ°¸æ˜Œä¸ƒå¹´å››æœˆåˆä¸‰ï¼ŒæˆŒæ—¶ä¸‰åˆ»</li>
               <li><strong>åœ°ç‚¹ï¼š</strong> æ²ˆåºœè¥¿å›­Â·æ¼±ç‰æ°´æ¦­</li>
               <li><strong>ç¯å¢ƒï¼š</strong> æœˆå…‰æ˜äº®ï¼Œå¾®é£ï¼Œæ°´å£°æ½ºæ½ºï¼Œå‚æŸ³ä¾ä¾</li>
           </ul>
           <h2>ç”¨æˆ·çŠ¶æ€</h2>
           <ul>
               <li><strong>èº«ä»½ï¼š</strong> æœªçŸ¥æ½œå…¥è€…</li>
               <li><strong>ä½ç½®ä¸å§¿åŠ¿ï¼š</strong> ç«‹äºæ°´æ¦­æ æ†æ—ï¼Œé¢å‘å‚æŸ³ä¸‹çš„æ²ˆçŸ¥å¾®</li>
               <li><strong>å½“å‰ç€è£…ï¼š</strong> æ·±é’è‰²åŠ²è£…ï¼Œè…°é—´æ‚¬ç©ºå‰‘é˜</li>
               <li><strong>æŒæœ‰ç‰©ï¼š</strong> ç‰¹æ®Šçº¹æ ·ç‰ä½©ï¼ˆå³æ‰‹ï¼‰</li>
           </ul>
           <h2>ä¸»è¦äº¤äº’è§’è‰²</h2>
           <ul>
               <li><strong>å§“åï¼š</strong> æ²ˆçŸ¥å¾®ï¼ˆæ²ˆåºœä¸‰å°å§ï¼‰</li>
               <li><strong>å½“å‰çŠ¶æ€ï¼š</strong> æƒŠç–‘ä¸å®šï¼Œå¼ºä½œé•‡å®šï¼Œç•¥å¸¦è­¦æƒ•</li>
               <li><strong>ä½ç½®ä¸å§¿åŠ¿ï¼š</strong> ç«™åœ¨å‚æŸ³ä¸‹ï¼Œå·¦æ‰‹æç¯ç¬¼ï¼Œå³æ‰‹å¾®æ¡</li>
               <li><strong>ç€è£…ç»†èŠ‚ï¼š</strong>
                   <ul>
                       <li><strong>å¤–è¡£/ä¸Šè£…ï¼š</strong> é¹…é»„çº±è¡«</li>
                       <li><strong>ä¸‹è£…/è£™ï¼š</strong> æœˆç™½ç™¾è¤¶è£™</li>
                       <li><strong>å†…è¡£è£¤ï¼š</strong> æè‰²ä¸»è…°ï¼ˆå¯è§é¢†ç¼˜ï¼‰</li>
                       <li><strong>é…é¥°ï¼š</strong> çç è€³ç¯ï¼Œå‘é—´ç¢§ç‰ç°ª</li>
                   </ul>
               </li>
           </ul>
       </div>
    </div>
    <div class="tab-panel" data-tab-panel="memory" role="tabpanel">
       <div class="memory-area">
           <h2>çŸ­æœŸè®°å¿†</h2>
           <ol>
               <li><strong>åˆšåˆš | æ°´æ¦­ | æ²ˆçŸ¥å¾®ï¼š</strong> å¥¹çœ‹åˆ°ç‰ä½©åæ˜æ˜¾æ„£ä½ï¼Œçœ¼ç¥å¤æ‚ã€‚</li>
               <li><strong>ç‰‡åˆ»å‰ | è¥¿å›­ï¼š</strong> é¿å¼€å·¡é€»æŠ¤å«ï¼Œæ½œå…¥æ°´æ¦­åŒºåŸŸã€‚</li>
           </ol>
           <h2>é•¿æœŸè®°å¿†</h2>
           <ol>
               <li><strong>æ°¸æ˜Œå¹´é—´ | ä»»åŠ¡ç®€æŠ¥ï¼š</strong> æ²ˆå®¶ä¸æŸä¸ªå¤±è½çš„ç»„ç»‡æœ‰å…³è”ï¼Œå…³é”®ä¿¡ç‰©æ˜¯ç‰¹æ®Šçº¹æ ·ç‰ä½©ã€‚</li>
               <li><strong>æ•°å¹´å‰ | å¸ˆé—¨ï¼š</strong> å¸ˆå‚…æ›¾æåŠç‰ä½©çš„é‡è¦æ€§ï¼Œå…³ç³»é‡å¤§ã€‚</li>
               <li><strong>ç«¥å¹´ | æ¨¡ç³Šå°è±¡ï¼š</strong> ä¼¼ä¹è§è¿‡ç±»ä¼¼çš„çº¹æ ·ï¼Œä½†è®°å¿†ä¸æ¸…ã€‚</li>
           </ol>
       </div>
    </div>
    <div class="tab-panel" data-tab-panel="options" role="tabpanel">
       <div class="options-area">
           <h2>å½“å‰é€‰é¡¹</h2>
           <ol>
               <li onclick="handleOptionClick(1)">[å°†ç‰ä½©æ”¶å…¥æ€€ä¸­ï¼Œå‹ä½å£°éŸ³ï¼š"å§‘å¨˜è®¤é”™äººäº†"]</li>
               <li onclick="handleOptionClick(2)">[ä¸¾èµ·ç‰ä½©é€¼è¿‘ï¼š"ä½ è®¤è¯†è¿™ç‰©ä»¶ï¼Ÿè¯´è¯´å®ƒçš„æ¥å†"]</li>
               <li onclick="handleOptionClick(3)">[çªç„¶æ½ä½å¥¹çš„è…°è·ƒå…¥å‡å±±åï¼Œè€³è¯­ï¼š"åˆ«å‡ºå£°ï¼Œæœ‰äººæ¥äº†"]</li>
               <li onclick="handleOptionClick(4)">[æ¸©å’Œè¯¢é—®ï¼š"å§‘å¨˜æ·±å¤œåœ¨æ­¤ï¼Œå¯æ˜¯é—è½äº†ä»€ä¹ˆï¼Ÿåœ¨ä¸‹æˆ–å¯å¸®å¿™ã€‚"]</li>
           </ol>
       </div>
    </div>
  </div>
</div>

<script>
  const panel = document.querySelector('.interactive-panel');
  const header = panel.querySelector('.panel-header');
  const toggleButton = panel.querySelector('.panel-toggle');
  const refreshButton = panel.querySelector('.panel-refresh'); // NEW
  const simplifyButton = panel.querySelector('.panel-simplify'); // NEW
  const panelStatusDisplay = document.getElementById('panelStatus'); // NEW
  const tabButtons = panel.querySelectorAll('.tab-button');
  const tabPanels = panel.querySelectorAll('.tab-panel');
  const tabNavigation = panel.querySelector('.tab-navigation');
  const tabContent = panel.querySelector('.tab-content');

  const animationDuration = 300; // Slightly faster animation

  // --- Status Update Function --- NEW
  function updateStatus(message, duration = 2000) {
      panelStatusDisplay.textContent = message;
      // Optionally reset status after a delay
      if (duration > 0) {
          setTimeout(() => {
              // Reset only if the current message is the one we set
              if (panelStatusDisplay.textContent === message) {
                  panelStatusDisplay.textContent = 'å°±ç»ª';
              }
          }, duration);
      }
  }

  // --- Dragging Logic (Unchanged) ---
  let isDragging = false, startX, startY, startLeft, startTop;
  header.addEventListener('mousedown', (e) => {
    // Prevent drag if clicking on a button within the header
    if (e.target.closest('.panel-header-button')) return;

    isDragging = true;
    startX = e.clientX;
    startY = e.clientY;
    const rect = panel.getBoundingClientRect();
    startLeft = rect.left;
    startTop = rect.top;
    document.body.style.userSelect = 'none';
    document.body.style.cursor = 'move';
    panel.style.willChange = 'top, left'; // Performance hint
  });

  document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    // Boundary checks slightly improved for visibility
    const newLeft = Math.max(0, Math.min(window.innerWidth - panel.offsetWidth, startLeft + dx));
    const newTop = Math.max(0, Math.min(window.innerHeight - panel.offsetHeight, startTop + dy));
    panel.style.left = `${newLeft}px`;
    panel.style.top = `${newTop}px`;
  });

  document.addEventListener('mouseup', () => {
    if (isDragging) {
        isDragging = false;
        document.body.style.userSelect = '';
        document.body.style.cursor = '';
        panel.style.willChange = 'auto'; // Remove hint
    }
  });

  // --- Collapse/Expand Logic (Slightly adjusted for clarity) ---
  toggleButton.addEventListener('click', () => {
    const isCollapsed = panel.classList.contains('panel-collapsed');
    const headerHeight = header.offsetHeight;

    panel.style.transition = `height ${animationDuration}ms ease, opacity ${animationDuration}ms ease`;
    panel.style.willChange = 'height, opacity'; // Performance hint

    if (isCollapsed) {
      // --- Expand ---
      const originalWidth = panel.dataset.originalWidth || panel.style.width || '420px'; // Use stored, style, or default
      const originalHeight = panel.dataset.originalHeight || panel.style.height || '500px'; // Use stored, style, or a sensible default

      // Set final state before removing class to help animation
      panel.style.width = originalWidth;
      panel.style.height = originalHeight;
      panel.style.opacity = '1'; // Ensure fully visible

      panel.classList.remove('panel-collapsed');
      toggleButton.textContent = 'â€“';
      toggleButton.title = 'æŠ˜å ';
      toggleButton.setAttribute('aria-label', 'æŠ˜å é¢æ¿');

      // Enable resize after animation
      setTimeout(() => {
          panel.style.transition = ''; // Use CSS transitions again
          panel.style.resize = 'both';
          panel.style.willChange = 'auto'; // Remove hint
          // Ensure height is not fixed if it was a default
          if (!panel.dataset.originalHeight) panel.style.height = '';
      }, animationDuration);

    } else {
      // --- Collapse ---
      // Store current size before collapsing
      panel.dataset.originalWidth = `${panel.offsetWidth}px`;
      panel.dataset.originalHeight = `${panel.offsetHeight}px`;

      // Apply collapsed class and styles for animation
      panel.style.width = `${panel.offsetWidth}px`; // Fix width
      panel.style.height = `${headerHeight}px`;
      panel.style.opacity = '0.9'; // Slightly fade when collapsed
      panel.style.resize = 'none'; // Disable resize immediately
      panel.classList.add('panel-collapsed');

      toggleButton.textContent = '+';
      toggleButton.title = 'å±•å¼€';
      toggleButton.setAttribute('aria-label', 'å±•å¼€é¢æ¿');

      // Clean up after animation
      setTimeout(() => {
         panel.style.transition = ''; // Use CSS transitions again
         panel.style.willChange = 'auto'; // Remove hint
      }, animationDuration);
    }
     // Update status briefly
    updateStatus(isCollapsed ? 'å·²å±•å¼€' : 'å·²æŠ˜å ', 1500);
  });

  // --- NEW: Button Click Handlers ---
  refreshButton.addEventListener('click', () => {
      console.log('Refresh button clicked');
      updateStatus('åˆ·æ–°ä¸­...', 1000);
      // Add actual refresh logic here
      // Example: Simulate work
      setTimeout(() => {
          updateStatus('åˆ·æ–°å®Œæˆ', 1500);
      }, 1000);
  });

  simplifyButton.addEventListener('click', () => {
      console.log('Simplify button clicked');
      updateStatus('ç®€åŒ–ä¸­...', 1000);
      // Add actual simplify logic here
      setTimeout(() => {
          updateStatus('ç®€åŒ–å®Œæˆ', 1500);
      }, 1000);
  });

  // --- NEW: Option Click Handler Example ---
  function handleOptionClick(optionNumber) {
      console.log(`Option ${optionNumber} clicked`);
      updateStatus(`é€‰æ‹©é€‰é¡¹ ${optionNumber}`, 2000);
      // Add logic to handle the selected option
  }


  // --- Tab Switching Logic (Unchanged) ---
  tabButtons.forEach(button => {
    button.addEventListener('click', () => {
        if (panel.classList.contains('panel-collapsed')) {
            return; // Don't switch tabs when collapsed
        }
        const target = button.getAttribute('data-tab-target');

        // Update button active states
        tabButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');

        // Update panel active states
        tabPanels.forEach(p => {
            p.classList.remove('active');
            p.style.display = 'none'; // Hide inactive panels
        });

        const targetPanel = panel.querySelector(`.tab-panel[data-tab-panel="${target}"]`);
        if (targetPanel) {
            targetPanel.style.display = 'block'; // Display target panel
            // Force reflow before adding class for animation
            void targetPanel.offsetWidth;
            targetPanel.classList.add('active');
        }
    });
  });

  // --- Initial State Setup (Slightly adjusted) ---
  function initializePanel() {
      const initialActiveButton = panel.querySelector('.tab-button.active');
      if (initialActiveButton) {
          const initialTarget = initialActiveButton.getAttribute('data-tab-target');
          const initialActivePanel = panel.querySelector(`.tab-panel[data-tab-panel="${initialTarget}"]`);
          if (initialActivePanel) {
              tabPanels.forEach(p => p.style.display = 'none'); // Hide all first
              initialActivePanel.style.display = 'block';
              initialActivePanel.classList.add('active'); // Ensure class is set
          }
      } else {
            // If no active button default to first tab
           const firstButton = panel.querySelector('.tab-button');
           const firstPanel = panel.querySelector('.tab-panel');
           if(firstButton && firstPanel){
               tabButtons.forEach(btn => btn.classList.remove('active'));
               tabPanels.forEach(p => { p.classList.remove('active'); p.style.display = 'none'; });
               firstButton.classList.add('active');
               firstPanel.classList.add('active');
               firstPanel.style.display = 'block';
           }
      }


      if (panel.classList.contains('panel-collapsed')) {
          panel.style.resize = 'none';
          panel.style.height = `${header.offsetHeight}px`;
          toggleButton.textContent = '+';
          toggleButton.title = 'å±•å¼€';
          toggleButton.setAttribute('aria-label', 'å±•å¼€é¢æ¿');
          panel.style.opacity = '0.9';
      } else {
          panel.style.resize = 'both';
          toggleButton.textContent = 'â€“';
          toggleButton.title = 'æŠ˜å ';
           toggleButton.setAttribute('aria-label', 'æŠ˜å é¢æ¿');
          panel.style.opacity = '1';
          // Ensure initial height isn't fixed if not collapsed
          // panel.style.height = ''; // Let content or CSS define it initially unless specified
      }

      updateStatus('é¢æ¿å·²åŠ è½½');
  }

  // Run initialization when the DOM is ready
  document.addEventListener('DOMContentLoaded', initializePanel);

</script>

</body>
</html>