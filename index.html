<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>‰∫§‰∫íÂºèÊÇ¨ÊµÆÈù¢Êùø v2.0 (Á¥´Ëâ≤‰∏ªÈ¢ò - Êñ∞ÊåâÈíÆ - Áä∂ÊÄÅÊòæÁ§∫)</title>
  <style>
    /* --- Base Styles --- */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      /* Updated background gradient */
      background: linear-gradient(135deg, #f3e8ff, #e9d5ff); /* Lighter purple gradient */
      font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif; /* Slightly modern font */
    }

    /* --- Panel Container --- */
    .interactive-panel {
      position: fixed;
      top: 60px;
      left: 60px;
      width: 420px; /* Initial width */
      max-height: 650px; /* Max height */
      /* New background/blur */
      background: rgba(250, 245, 255, 0.65); /* Very light purple semi-transparent */
      backdrop-filter: blur(14px);
      border-radius: 18px; /* Slightly adjusted radius */
      /* Updated shadow with purple tint */
      box-shadow: 0 8px 25px rgba(109, 40, 217, 0.1); /* Subtle purple shadow */
      display: flex;
      flex-direction: column;
      overflow: hidden;
      resize: both;
      transition: box-shadow 0.3s ease;
      z-index: 9999;
      min-width: 250px; /* Adjusted min-width to accommodate controls */
      min-height: 50px; /* Min height for header */
      border: 1px solid rgba(167, 139, 250, 0.3); /* Subtle border */
    }
    .interactive-panel:hover {
      box-shadow: 0 12px 30px rgba(109, 40, 217, 0.18); /* Enhanced purple shadow on hover */
    }

    /* --- Collapsed State --- */
    .panel-collapsed {
      overflow: hidden !important;
      resize: none !important;
      /* height is set by JS */
    }
    .panel-collapsed .tab-navigation,
    .panel-collapsed .tab-content {
      display: none;
    }

    /* --- Panel Header --- */
    .panel-header {
      /* New header background */
      background: linear-gradient(to right, #6d28d9, #8b5cf6); /* Vibrant purple gradient */
      color: #fff;
      padding: 10px 15px; /* Adjusted padding */
      cursor: move;
      display: flex;
      align-items: center;
      justify-content: space-between;
      user-select: none;
      font-size: 1rem; /* 16px */
      font-weight: 600; /* Slightly bolder */
      box-sizing: border-box;
      min-height: 48px; /* Ensure min height */
      flex-shrink: 0; /* Prevent header from shrinking */
    }
    .panel-title-area {
        display: flex;
        align-items: center;
        gap: 10px; /* Space between title and status */
        /* Allow title area to shrink if needed, but give it priority */
        flex-grow: 1;
        flex-shrink: 1;
        min-width: 50px; /* Prevent extreme collapse */
        overflow: hidden; /* Hide overflow if title+status is too long */
    }
    .panel-title {
        white-space: nowrap; /* Prevent title wrap */
        overflow: hidden;
        text-overflow: ellipsis; /* Add ellipsis if title is too long */
    }
    /* NEW: Status Display */
    .panel-status-display {
      font-size: 0.8rem; /* Smaller font size */
      font-weight: 400;
      padding: 2px 6px;
      background: rgba(255, 255, 255, 0.2); /* Subtle background */
      border-radius: 4px;
      white-space: nowrap; /* Prevent status text wrap */
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100px; /* Limit status width */
    }
    /* Container for control buttons */
    .panel-controls {
        display: flex;
        align-items: center;
        gap: 5px; /* Space between buttons */
        flex-shrink: 0; /* Prevent controls from shrinking */
    }
    /* Shared button style for header controls */
    .panel-header-button {
      background: transparent;
      border: none;
      color: #ede9fe; /* Light violet text */
      font-size: 1.1rem; /* Slightly larger icons */
      cursor: pointer;
      transition: transform 0.2s ease, color 0.2s ease;
      padding: 0 5px;
      line-height: 1;
      border-radius: 4px; /* Subtle rounding */
    }
    .panel-header-button:hover {
      transform: scale(1.15);
      color: #ffffff; /* Brighter white on hover */
    }
    .panel-header-button:active {
        transform: scale(1.05); /* Click feedback */
    }
    /* Specific classes if needed, but shared style is likely fine */
    .panel-toggle {}
    .panel-refresh {}
    .panel-simplify {}

    /* --- Tab Navigation --- */
    .tab-navigation {
      display: flex;
      /* New tab nav background */
      background: rgba(237, 233, 254, 0.8); /* Lighter violet */
      border-bottom: 1px solid #c4b5fd; /* Violet border */
      flex-shrink: 0;
      padding: 3px 5px 0; /* Add padding for spacing and to lift buttons */
    }
    .tab-button {
      flex: 1;
      padding: 9px 5px; /* Adjusted padding */
      background: transparent;
      border: none;
      font-size: 0.875rem; /* 14px */
      cursor: pointer;
      transition: background 0.3s, color 0.3s, border-color 0.3s;
      color: #5b21b6; /* Darker violet text */
      white-space: nowrap;
      border-bottom: 3px solid transparent; /* Placeholder for active indicator */
      margin: 0 2px;
      border-radius: 6px 6px 0 0; /* Round top corners */
    }
    .tab-button:hover {
      background: rgba(196, 181, 253, 0.4); /* Lighter violet hover */
      color: #4c1d95; /* Darker violet on hover */
    }
    .tab-button.active {
      /* Active tab uses header gradient */
      background: linear-gradient(to right, #a78bfa, #c4b5fd); /* Lighter purple gradient */
      color: #3730a3; /* Dark indigo text for contrast */
      font-weight: 600;
      border-bottom: 3px solid #6d28d9; /* Strong purple indicator */
    }

    /* --- Tab Content --- */
    .tab-content {
      flex: 1;
      overflow-y: auto;
      padding: 15px 20px; /* Adjusted padding */
      background: transparent;
      transition: opacity 0.4s ease;
      min-height: 100px; /* Ensure minimum content height */
      color: #374151; /* Dark gray content text */
    }
    .tab-panel {
      display: none;
      animation: fadeIn 0.4s ease forwards;
    }
    .tab-panel.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* --- Content Specific Styles (Purple Theme) --- */
    .tab-panel h2 {
      color: #6d28d9; /* Main purple for headings */
      margin-top: 0;
      margin-bottom: 15px;
      border-bottom: 1px solid #ddd6fe; /* Light violet underline */
      padding-bottom: 5px;
    }
    .tab-panel strong {
      color: #7c3aed; /* Slightly lighter purple for strong tags */
    }

    .memory-area ol { position: relative; margin-left: 15px; padding-left: 25px; list-style: none; }
    .memory-area ol::before { content: ""; position: absolute; left: 8px; top: 5px; bottom: 5px; width: 2px; background: #a78bfa; border-radius: 1px; } /* Lighter purple line */
    .memory-area ol li { position: relative; padding: 10px 0; }
    .memory-area ol li::before { content: ""; position: absolute; left: -21px; top: 50%; transform: translateY(-50%); width: 10px; height: 10px; background: #8b5cf6; border-radius: 50%; border: 2px solid #f3e8ff; } /* Purple dot with light bg border */

    .status-bar ul { padding-left: 20px; margin: 10px 0; }
    .status-bar ul ul { padding-left: 20px; }
    .status-bar li { margin-bottom: 5px; }

    .options-area ol { list-style: none; padding: 0; margin: 0; }
    .options-area li {
      background: rgba(167, 139, 250, 0.15); /* Light violet background */
      margin-bottom: 10px;
      padding: 12px 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
      border-left: 4px solid #a78bfa; /* Accent border */
      color: #4c1d95; /* Darker violet text */
    }
    .options-area li:hover {
      background: rgba(167, 139, 250, 0.25);
      transform: translateY(-2px);
      box-shadow: 0 3px 8px rgba(109, 40, 217, 0.08);
      border-left-color: #8b5cf6; /* Darker accent on hover */
    }

    .thinking-area ul { list-style: disc inside; margin: 0; padding: 0 0 0 15px; color: #5b21b6; }
    .thinking-area li { margin-bottom: 8px; }

    .text-body p { margin: 10px 0; line-height: 1.6; }
    /* Updated special text colors */
    .speech { color: #7c3aed; font-weight: bold; }
    .mentality { color: #9333ea; font-style: italic; } /* More distinct purple */
    .closeup { color: #5b21b6; text-decoration: underline; text-decoration-color: #a78bfa; text-decoration-thickness: 1px; text-underline-offset: 2px; } /* Darker purple underline */

    /* Scrollbar styling (optional, for a more themed look) */
    .tab-content::-webkit-scrollbar {
        width: 8px;
    }
    .tab-content::-webkit-scrollbar-track {
        background: #f3e8ff; /* Lightest purple */
        border-radius: 4px;
    }
    .tab-content::-webkit-scrollbar-thumb {
        background-color: #c4b5fd; /* Medium purple */
        border-radius: 4px;
        border: 2px solid #f3e8ff; /* Creates padding around thumb */
    }
    .tab-content::-webkit-scrollbar-thumb:hover {
        background-color: #a78bfa; /* Darker purple on hover */
    }

  </style>
</head>
<body>

<div class="interactive-panel">
  <div class="panel-header">
    <!-- Title and Status Area -->
    <div class="panel-title-area">
        <div class="panel-title">‰∫§‰∫íÈù¢Êùø</div>
        <span class="panel-status-display" id="panelStatus">Â∞±Áª™</span> <!-- NEW -->
    </div>
    <!-- Control Buttons Area -->
    <div class="panel-controls"> <!-- NEW -->
        <button class="panel-header-button panel-refresh" title="Âà∑Êñ∞" aria-label="Âà∑Êñ∞">üîÑ</button> <!-- NEW -->
        <button class="panel-header-button panel-simplify" title="ÁÆÄÂåñÂõûÂ§ç" aria-label="ÁÆÄÂåñÂõûÂ§ç">‚ú®</button> <!-- NEW -->
        <button class="panel-header-button panel-toggle" title="ÊäòÂè†/Â±ïÂºÄ" aria-label="ÊäòÂè†/Â±ïÂºÄ">‚Äì</button>
    </div>
  </div>
  <div class="tab-navigation">
    <button class="tab-button active" data-tab-target="text">ÊñáÊú¨ÂÜÖÂÆπ</button>
    <button class="tab-button" data-tab-target="thinking">ÊÄùËÄÉÂå∫</button>
    <button class="tab-button" data-tab-target="status">Áä∂ÊÄÅ‰ø°ÊÅØ</button>
    <button class="tab-button" data-tab-target="memory">ËÆ∞ÂøÜ</button>
    <button class="tab-button" data-tab-target="options">ÈÄâÈ°π</button>
  </div>
  <div class="tab-content">
     <div class="tab-panel active" data-tab-panel="text" role="tabpanel">
      <div class="text-body">
        <h2>ÊñáÁ´†Ê†áÈ¢òÁ§∫‰æã</h2>
        <p>ËøôÊòØ‰∏ÄÊÆµÁ§∫‰æãÊñáÊú¨ÂÜÖÂÆπÔºåÂ±ïÁ§∫‰∫ÜÂü∫Á°ÄÁöÑÊÆµËêΩÊ†∑Âºè„ÄÇÊÇ®ÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅÂ°´ÂÖÖÂÆûÈôÖÂÜÖÂÆπ„ÄÇ</p>
        <p>ËøôÊòØ‰∏Ä‰∏™ÂØπËØùÔºö<span class="speech">‚Äú‰Ω†Â•ΩÔºåÊ≤àÂ∞èÂßê„ÄÇËøôÂùóÁéâ‰Ω©‰ºº‰πéÂØπ‰Ω†ÂæàÈáçË¶ÅÔºü‚Äù</span></p>
        <p>ËøôÊòØ‰∏Ä‰∏™ÂøÉÁêÜÊ¥ªÂä®Ôºö<span class="mentality">Ôºà‰ªñÊÄé‰πà‰ºöÁü•ÈÅìËøôÁéâ‰Ω©... ÈöæÈÅìÊòØÊØç‰∫≤ÈÇ£ËæπÁöÑ‰∫∫ÔºüÔºâ</span></p>
        <p>ËøôÊòØ‰∏Ä‰∏™ÁâπÂÜôÔºö<span class="closeup">„ÄåÁéâ‰Ω©Âú®ÊúàÂÖâ‰∏ãÊ≥õÁùÄÊ∏©Ê∂¶ÁöÑÂÖâÊ≥ΩÔºåÂ•áÁâπÁöÑÁ∫πÊ†∑Ëã•ÈöêËã•Áé∞„ÄÇ„Äç</span></p>
        <p>Êõ¥Â§öÂÜÖÂÆπÂèØ‰ª•Ê∑ªÂä†Âú®ËøôÈáåÔºåÊªöÂä®Êù°‰ºöÂú®ÂÜÖÂÆπË∂ÖÂá∫Êó∂Âá∫Áé∞„ÄÇ</p>
      </div>
    </div>
    <div class="tab-panel" data-tab-panel="thinking" role="tabpanel">
       <div class="thinking-area">
           <h2>ÊÄùËÄÉËøáÁ®ã</h2>
           <ul>
               <li>ÁõÆÊ†áÔºö‰∏éÊ≤àÁü•ÂæÆ‰∫§‰∫íÔºåÊé¢Êü•Áéâ‰Ω©‰ø°ÊÅØ„ÄÇ</li>
               <li>ÂàùÊ≠•ËßÇÂØüÔºöÂ•πÂØπÁéâ‰Ω©ÂèçÂ∫îÂº∫ÁÉàÔºåÂèØËÉΩËÆ§ËØÜ„ÄÇ</li>
               <li>È£éÈô©ËØÑ‰º∞ÔºöÁõ¥Êé•ËØ¢ÈóÆÂèØËÉΩÂºïËµ∑Ë≠¶ÊÉïÔºåÁîöËá≥ÂÜ≤Á™Å„ÄÇ</li>
               <li>Á≠ñÁï•1ÔºöËØïÊé¢ÊÄßËØ¢ÈóÆÔºåËßÇÂØüÂèçÂ∫î„ÄÇ</li>
               <li>Á≠ñÁï•2ÔºöËã•ÈÅáÂç±Èô©ÔºåÂà©Áî®ÁéØÂ¢ÉËÑ±Ë∫´ÔºàÂÅáÂ±±„ÄÅÊ∞¥ÂüüÔºâ„ÄÇ</li>
               <li>ÂΩìÂâçÂÜ≥ÂÆöÔºöÈááÁî®Á≠ñÁï•1ÔºåË®ÄËØ≠Ê∏©ÂíåÔºå‰øùÊåÅË∑ùÁ¶ª„ÄÇ</li>
           </ul>
       </div>
    </div>
    <div class="tab-panel" data-tab-panel="status" role="tabpanel">
       <div class="status-bar">
           <h2>Âú∫ÊôØ‰ø°ÊÅØ</h2>
           <ul>
               <li><strong>Êó∂Èó¥Ôºö</strong> Ê∞∏Êòå‰∏ÉÂπ¥ÂõõÊúàÂàù‰∏âÔºåÊàåÊó∂‰∏âÂàª</li>
               <li><strong>Âú∞ÁÇπÔºö</strong> Ê≤àÂ∫úË•øÂõ≠¬∑Êº±ÁéâÊ∞¥Ê¶≠</li>
               <li><strong>ÁéØÂ¢ÉÔºö</strong> ÊúàÂÖâÊòé‰∫ÆÔºåÂæÆÈ£éÔºåÊ∞¥Â£∞ÊΩ∫ÊΩ∫ÔºåÂûÇÊü≥‰æù‰æù</li>
           </ul>
           <h2>Áî®Êà∑Áä∂ÊÄÅ</h2>
           <ul>
               <li><strong>Ë∫´‰ªΩÔºö</strong> Êú™Áü•ÊΩúÂÖ•ËÄÖ</li>
               <li><strong>‰ΩçÁΩÆ‰∏éÂßøÂäøÔºö</strong> Á´ã‰∫éÊ∞¥Ê¶≠Ê†èÊùÜÊóÅÔºåÈù¢ÂêëÂûÇÊü≥‰∏ãÁöÑÊ≤àÁü•ÂæÆ</li>
               <li><strong>ÂΩìÂâçÁùÄË£ÖÔºö</strong> Ê∑±ÈùíËâ≤Âä≤Ë£ÖÔºåËÖ∞Èó¥ÊÇ¨Á©∫ÂâëÈûò</li>
               <li><strong>ÊåÅÊúâÁâ©Ôºö</strong> ÁâπÊÆäÁ∫πÊ†∑Áéâ‰Ω©ÔºàÂè≥ÊâãÔºâ</li>
           </ul>
           <h2>‰∏ªË¶Å‰∫§‰∫íËßíËâ≤</h2>
           <ul>
               <li><strong>ÂßìÂêçÔºö</strong> Ê≤àÁü•ÂæÆÔºàÊ≤àÂ∫ú‰∏âÂ∞èÂßêÔºâ</li>
               <li><strong>ÂΩìÂâçÁä∂ÊÄÅÔºö</strong> ÊÉäÁñë‰∏çÂÆöÔºåÂº∫‰ΩúÈïáÂÆöÔºåÁï•Â∏¶Ë≠¶ÊÉï</li>
               <li><strong>‰ΩçÁΩÆ‰∏éÂßøÂäøÔºö</strong> Á´ôÂú®ÂûÇÊü≥‰∏ãÔºåÂ∑¶ÊâãÊèêÁÅØÁ¨ºÔºåÂè≥ÊâãÂæÆÊè°</li>
               <li><strong>ÁùÄË£ÖÁªÜËäÇÔºö</strong>
                   <ul>
                       <li><strong>Â§ñË°£/‰∏äË£ÖÔºö</strong> ÈπÖÈªÑÁ∫±Ë°´</li>
                       <li><strong>‰∏ãË£Ö/Ë£ôÔºö</strong> ÊúàÁôΩÁôæË§∂Ë£ô</li>
                       <li><strong>ÂÜÖË°£Ë£§Ôºö</strong> ÊùèËâ≤‰∏ªËÖ∞ÔºàÂèØËßÅÈ¢ÜÁºòÔºâ</li>
                       <li><strong>ÈÖçÈ•∞Ôºö</strong> ÁèçÁè†ËÄ≥ÁéØÔºåÂèëÈó¥Á¢ßÁéâÁ∞™</li>
                   </ul>
               </li>
           </ul>
       </div>
    </div>
    <div class="tab-panel" data-tab-panel="memory" role="tabpanel">
       <div class="memory-area">
           <h2>Áü≠ÊúüËÆ∞ÂøÜ</h2>
           <ol>
               <li><strong>ÂàöÂàö | Ê∞¥Ê¶≠ | Ê≤àÁü•ÂæÆÔºö</strong> Â•πÁúãÂà∞Áéâ‰Ω©ÂêéÊòéÊòæÊÑ£‰ΩèÔºåÁúºÁ•ûÂ§çÊùÇ„ÄÇ</li>
               <li><strong>ÁâáÂàªÂâç | Ë•øÂõ≠Ôºö</strong> ÈÅøÂºÄÂ∑°ÈÄªÊä§Âç´ÔºåÊΩúÂÖ•Ê∞¥Ê¶≠Âå∫Âüü„ÄÇ</li>
           </ol>
           <h2>ÈïøÊúüËÆ∞ÂøÜ</h2>
           <ol>
               <li><strong>Ê∞∏ÊòåÂπ¥Èó¥ | ‰ªªÂä°ÁÆÄÊä•Ôºö</strong> Ê≤àÂÆ∂‰∏éÊüê‰∏™Â§±ËêΩÁöÑÁªÑÁªáÊúâÂÖ≥ËÅîÔºåÂÖ≥ÈîÆ‰ø°Áâ©ÊòØÁâπÊÆäÁ∫πÊ†∑Áéâ‰Ω©„ÄÇ</li>
               <li><strong>Êï∞Âπ¥Ââç | Â∏àÈó®Ôºö</strong> Â∏àÂÇÖÊõæÊèêÂèäÁéâ‰Ω©ÁöÑÈáçË¶ÅÊÄßÔºåÂÖ≥Á≥ªÈáçÂ§ß„ÄÇ</li>
               <li><strong>Á´•Âπ¥ | Ê®°Á≥äÂç∞Ë±°Ôºö</strong> ‰ºº‰πéËßÅËøáÁ±ª‰ººÁöÑÁ∫πÊ†∑Ôºå‰ΩÜËÆ∞ÂøÜ‰∏çÊ∏Ö„ÄÇ</li>
           </ol>
       </div>
    </div>
    <div class="tab-panel" data-tab-panel="options" role="tabpanel">
       <div class="options-area">
           <h2>ÂΩìÂâçÈÄâÈ°π</h2>
           <ol>
               <li onclick="handleOptionClick(1)">[Â∞ÜÁéâ‰Ω©Êî∂ÂÖ•ÊÄÄ‰∏≠ÔºåÂéã‰ΩéÂ£∞Èü≥Ôºö"ÂßëÂ®òËÆ§Èîô‰∫∫‰∫Ü"]</li>
               <li onclick="handleOptionClick(2)">[‰∏æËµ∑Áéâ‰Ω©ÈÄºËøëÔºö"‰Ω†ËÆ§ËØÜËøôÁâ©‰ª∂ÔºüËØ¥ËØ¥ÂÆÉÁöÑÊù•ÂéÜ"]</li>
               <li onclick="handleOptionClick(3)">[Á™ÅÁÑ∂ÊèΩ‰ΩèÂ•πÁöÑËÖ∞Ë∑ÉÂÖ•ÂÅáÂ±±ÂêéÔºåËÄ≥ËØ≠Ôºö"Âà´Âá∫Â£∞ÔºåÊúâ‰∫∫Êù•‰∫Ü"]</li>
               <li onclick="handleOptionClick(4)">[Ê∏©ÂíåËØ¢ÈóÆÔºö"ÂßëÂ®òÊ∑±Â§úÂú®Ê≠§ÔºåÂèØÊòØÈÅóËêΩ‰∫Ü‰ªÄ‰πàÔºüÂú®‰∏ãÊàñÂèØÂ∏ÆÂøô„ÄÇ"]</li>
           </ol>
       </div>
    </div>
  </div>
</div>

<script>
  const panel = document.querySelector('.interactive-panel');
  const header = panel.querySelector('.panel-header');
  const toggleButton = panel.querySelector('.panel-toggle');
  const refreshButton = panel.querySelector('.panel-refresh'); // NEW
  const simplifyButton = panel.querySelector('.panel-simplify'); // NEW
  const panelStatusDisplay = document.getElementById('panelStatus'); // NEW
  const tabButtons = panel.querySelectorAll('.tab-button');
  const tabPanels = panel.querySelectorAll('.tab-panel');
  const tabNavigation = panel.querySelector('.tab-navigation');
  const tabContent = panel.querySelector('.tab-content');

  const animationDuration = 300; // Slightly faster animation

  // --- Status Update Function --- NEW
  function updateStatus(message, duration = 2000) {
      panelStatusDisplay.textContent = message;
      // Optionally reset status after a delay
      if (duration > 0) {
          setTimeout(() => {
              // Reset only if the current message is the one we set
              if (panelStatusDisplay.textContent === message) {
                  panelStatusDisplay.textContent = 'Â∞±Áª™';
              }
          }, duration);
      }
  }

  // --- Dragging Logic (Unchanged) ---
  let isDragging = false, startX, startY, startLeft, startTop;
  header.addEventListener('mousedown', (e) => {
    // Prevent drag if clicking on a button within the header
    if (e.target.closest('.panel-header-button')) return;

    isDragging = true;
    startX = e.clientX;
    startY = e.clientY;
    const rect = panel.getBoundingClientRect();
    startLeft = rect.left;
    startTop = rect.top;
    document.body.style.userSelect = 'none';
    document.body.style.cursor = 'move';
    panel.style.willChange = 'top, left'; // Performance hint
  });

  document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    // Boundary checks slightly improved for visibility
    const newLeft = Math.max(0, Math.min(window.innerWidth - panel.offsetWidth, startLeft + dx));
    const newTop = Math.max(0, Math.min(window.innerHeight - panel.offsetHeight, startTop + dy));
    panel.style.left = `${newLeft}px`;
    panel.style.top = `${newTop}px`;
  });

  document.addEventListener('mouseup', () => {
    if (isDragging) {
        isDragging = false;
        document.body.style.userSelect = '';
        document.body.style.cursor = '';
        panel.style.willChange = 'auto'; // Remove hint
    }
  });

  // --- Collapse/Expand Logic (Slightly adjusted for clarity) ---
  toggleButton.addEventListener('click', () => {
    const isCollapsed = panel.classList.contains('panel-collapsed');
    const headerHeight = header.offsetHeight;

    panel.style.transition = `height ${animationDuration}ms ease, opacity ${animationDuration}ms ease`;
    panel.style.willChange = 'height, opacity'; // Performance hint

    if (isCollapsed) {
      // --- Expand ---
      const originalWidth = panel.dataset.originalWidth || panel.style.width || '420px'; // Use stored, style, or default
      const originalHeight = panel.dataset.originalHeight || panel.style.height || '500px'; // Use stored, style, or a sensible default

      // Set final state before removing class to help animation
      panel.style.width = originalWidth;
      panel.style.height = originalHeight;
      panel.style.opacity = '1'; // Ensure fully visible

      panel.classList.remove('panel-collapsed');
      toggleButton.textContent = '‚Äì';
      toggleButton.title = 'ÊäòÂè†';
      toggleButton.setAttribute('aria-label', 'ÊäòÂè†Èù¢Êùø');

      // Enable resize after animation
      setTimeout(() => {
          panel.style.transition = ''; // Use CSS transitions again
          panel.style.resize = 'both';
          panel.style.willChange = 'auto'; // Remove hint
          // Ensure height is not fixed if it was a default
          if (!panel.dataset.originalHeight) panel.style.height = '';
      }, animationDuration);

    } else {
      // --- Collapse ---
      // Store current size before collapsing
      panel.dataset.originalWidth = `${panel.offsetWidth}px`;
      panel.dataset.originalHeight = `${panel.offsetHeight}px`;

      // Apply collapsed class and styles for animation
      panel.style.width = `${panel.offsetWidth}px`; // Fix width
      panel.style.height = `${headerHeight}px`;
      panel.style.opacity = '0.9'; // Slightly fade when collapsed
      panel.style.resize = 'none'; // Disable resize immediately
      panel.classList.add('panel-collapsed');

      toggleButton.textContent = '+';
      toggleButton.title = 'Â±ïÂºÄ';
      toggleButton.setAttribute('aria-label', 'Â±ïÂºÄÈù¢Êùø');

      // Clean up after animation
      setTimeout(() => {
         panel.style.transition = ''; // Use CSS transitions again
         panel.style.willChange = 'auto'; // Remove hint
      }, animationDuration);
    }
     // Update status briefly
    updateStatus(isCollapsed ? 'Â∑≤Â±ïÂºÄ' : 'Â∑≤ÊäòÂè†', 1500);
  });

  // --- NEW: Button Click Handlers ---
  refreshButton.addEventListener('click', () => {
      console.log('Refresh button clicked');
      updateStatus('Âà∑Êñ∞‰∏≠...', 1000);
      // Add actual refresh logic here
      // Example: Simulate work
      setTimeout(() => {
          updateStatus('Âà∑Êñ∞ÂÆåÊàê', 1500);
      }, 1000);
  });

  simplifyButton.addEventListener('click', () => {
      console.log('Simplify button clicked');
      updateStatus('ÁÆÄÂåñ‰∏≠...', 1000);
      // Add actual simplify logic here
      setTimeout(() => {
          updateStatus('ÁÆÄÂåñÂÆåÊàê', 1500);
      }, 1000);
  });

  // --- NEW: Option Click Handler Example ---
  function handleOptionClick(optionNumber) {
      console.log(`Option ${optionNumber} clicked`);
      updateStatus(`ÈÄâÊã©ÈÄâÈ°π ${optionNumber}`, 2000);
      // Add logic to handle the selected option
  }


  // --- Tab Switching Logic (Unchanged) ---
  tabButtons.forEach(button => {
    button.addEventListener('click', () => {
        if (panel.classList.contains('panel-collapsed')) {
            return; // Don't switch tabs when collapsed
        }
        const target = button.getAttribute('data-tab-target');

        // Update button active states
        tabButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');

        // Update panel active states
        tabPanels.forEach(p => {
            p.classList.remove('active');
            p.style.display = 'none'; // Hide inactive panels
        });

        const targetPanel = panel.querySelector(`.tab-panel[data-tab-panel="${target}"]`);
        if (targetPanel) {
            targetPanel.style.display = 'block'; // Display target panel
            // Force reflow before adding class for animation
            void targetPanel.offsetWidth;
            targetPanel.classList.add('active');
        }
    });
  });

  // --- Initial State Setup (Slightly adjusted) ---
  function initializePanel() {
      const initialActiveButton = panel.querySelector('.tab-button.active');
      if (initialActiveButton) {
          const initialTarget = initialActiveButton.getAttribute('data-tab-target');
          const initialActivePanel = panel.querySelector(`.tab-panel[data-tab-panel="${initialTarget}"]`);
          if (initialActivePanel) {
              tabPanels.forEach(p => p.style.display = 'none'); // Hide all first
              initialActivePanel.style.display = 'block';
              initialActivePanel.classList.add('active'); // Ensure class is set
          }
      } else {
            // If no active button default to first tab
           const firstButton = panel.querySelector('.tab-button');
           const firstPanel = panel.querySelector('.tab-panel');
           if(firstButton && firstPanel){
               tabButtons.forEach(btn => btn.classList.remove('active'));
               tabPanels.forEach(p => { p.classList.remove('active'); p.style.display = 'none'; });
               firstButton.classList.add('active');
               firstPanel.classList.add('active');
               firstPanel.style.display = 'block';
           }
      }


      if (panel.classList.contains('panel-collapsed')) {
          panel.style.resize = 'none';
          panel.style.height = `${header.offsetHeight}px`;
          toggleButton.textContent = '+';
          toggleButton.title = 'Â±ïÂºÄ';
          toggleButton.setAttribute('aria-label', 'Â±ïÂºÄÈù¢Êùø');
          panel.style.opacity = '0.9';
      } else {
          panel.style.resize = 'both';
          toggleButton.textContent = '‚Äì';
          toggleButton.title = 'ÊäòÂè†';
           toggleButton.setAttribute('aria-label', 'ÊäòÂè†Èù¢Êùø');
          panel.style.opacity = '1';
          // Ensure initial height isn't fixed if not collapsed
          // panel.style.height = ''; // Let content or CSS define it initially unless specified
      }

      updateStatus('Èù¢ÊùøÂ∑≤Âä†ËΩΩ');
  }

  // Run initialization when the DOM is ready
  document.addEventListener('DOMContentLoaded', initializePanel);

</script>

</body>
</html>